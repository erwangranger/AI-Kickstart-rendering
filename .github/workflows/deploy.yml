# name: Deploy to GitHub Pages (Per-Branch Previews)
#
# on:
#   push:
#     branches:
#       - main
#       - '*' # Trigger on pushes to all branches
#   pull_request:
#     types: [opened, synchronize, reopened] # Trigger on PR creation, updates, and reopening
#   schedule:
#     - cron: '0 * * * *'  # Run every hour
#
# # Explicitly grant permissions to the GH_TOKEN for GitHub Pages deployment
# permissions:
#   contents: write # Needed to push to the gh-pages branch
#   pages: write    # Needed for GitHub Pages deployment
#   id-token: write # Needed for OpenID Connect
#
# jobs:
#   build-and-deploy:
#     runs-on: ubuntu-latest
#     env:
#       GH_TOKEN: ${{ secrets.GH_TOKEN }}  # Set token for all steps
#
#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v3
#
#       - name: Clean install
#         run: |
#           rm -rf node_modules
#           npm cache clean --force
#
#       - name: Set up Node.js
#         uses: actions/setup-node@v3
#         with:
#           node-version: '20'
#           cache: 'npm'
#
#       - name: Cache npm dependencies
#         uses: actions/cache@v3
#         with:
#           path: ~/.npm
#           key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
#           restore-keys: |
#             ${{ runner.os }}-node-
#
#       - name: Generate static kickstarts data
#         run: |
#           npm install node-fetch@2
#           node scripts/generate-static.js
#
#       - name: Ensure static data is in public directory
#         run: |
#           if [ -f data/kickstarts.json ]; then
#             mkdir -p public/data
#             cp data/kickstarts.json public/data/kickstarts.json
#           fi
#
#       - name: Build
#         env:
#           NODE_ENV: production
#           npm_config_loglevel: verbose
#         run: |
#           npm ci --include=dev
#           if [ -f /home/runner/.npm/_logs/*-debug-0.log ]; then
#             echo "=== npm debug log ==="
#             cat /home/runner/.npm/_logs/*-debug-0.log
#             echo "=== end npm debug log ==="
#           fi
#           npm run build
#
#       - name: Deploy
#         uses: peaceiris/actions-gh-pages@v3
#         with:
#           github_token: ${{ secrets.GITHUB_TOKEN }}
#           publish_dir: ./build
#           publish_branch: gh-pages
#           commit_message: "Update site: ${{ github.event_name }}"
#           keep_files: true
